`$expr`ì€ MongoDB ì¿¼ë¦¬ì—ì„œ **ê°™ì€ ë„íë¨¼íŠ¸(document) ë‚´ì˜ í•„ë“œë¼ë¦¬ ë¹„êµ**í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê°•ë ¥í•œ ì—°ì‚°ìì…ë‹ˆë‹¤.

ì¼ë°˜ì ì¸ ì¿¼ë¦¬ëŠ” í•„ë“œ ê°’ì„ \*\*ì •ì ì¸ ê°’(static value)\*\*ê³¼ ë¹„êµí•˜ì§€ë§Œ, `$expr`ì„ ì‚¬ìš©í•˜ë©´ í•„ë“œ ê°’ì„ **ë‹¤ë¥¸ í•„ë“œì˜ ê°’**ì´ë‚˜ **ê³„ì‚°ëœ ê²°ê³¼**ì™€ ë™ì ìœ¼ë¡œ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

-----

### \#\# `$expr`ì˜ í•µì‹¬ ê°œë… ğŸ’¡

ì¼ë°˜ì ì¸ MongoDB `find` ì¿¼ë¦¬ë¥¼ ìƒê°í•´ ë³´ì„¸ìš”.

```javascript
// 'inventory' ì»¬ë ‰ì…˜ì—ì„œ quantityê°€ 20ì¸ ë„íë¨¼íŠ¸ ì°¾ê¸°
db.inventory.find({ quantity: 20 })
```

ì´ ì¿¼ë¦¬ëŠ” `quantity` í•„ë“œì˜ ê°’ì„ \*\*ê³ ì •ëœ ê°’ `20`\*\*ê³¼ ë¹„êµí•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ ë§Œì•½ "ì£¼ë¬¸ ìˆ˜ëŸ‰(`ordered`)ì´ í˜„ì¬ ì¬ê³ (`in_stock`)ë³´ë‹¤ ë§ì€ ìƒí’ˆì„ ì°¾ê³  ì‹¶ë‹¤"ì™€ ê°™ì€ ìš”êµ¬ì‚¬í•­ì´ ìˆë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”? ë‘ í•„ë“œëŠ” ê°™ì€ ë„íë¨¼íŠ¸ ì•ˆì— ìˆìœ¼ë©°, ë„íë¨¼íŠ¸ë§ˆë‹¤ ê·¸ ê°’ì´ ë‹¤ë¦…ë‹ˆë‹¤.

ì´ë•Œ `$expr`ì´ ì‚¬ìš©ë©ë‹ˆë‹¤. `$expr`ì€ ì¿¼ë¦¬ ë‚´ì—ì„œ **ì§‘ê³„ í‘œí˜„ì‹(Aggregation Expression)** ë¬¸ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê°™ì€ ë„íë¨¼íŠ¸ ë‚´ í•„ë“œë“¤ì„ ì„œë¡œ ì°¸ì¡°í•˜ê³  ë¹„êµí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.

-----

### \#\# ì‚¬ìš©ë²• ë° ì˜ˆì‹œ

`$expr`ì€ `find()` ë©”ì†Œë“œì™€ ì§‘ê³„ íŒŒì´í”„ë¼ì¸ì˜ `$match` ë‹¨ê³„ì—ì„œ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### **ì˜ˆì‹œ 1: ë‘ í•„ë“œì˜ ê°’ ì§ì ‘ ë¹„êµí•˜ê¸°**

`monthly_budget` ì»¬ë ‰ì…˜ì— ê° ë¶€ì„œì˜ ì˜ˆì‚°(`budget`)ê³¼ ì§€ì¶œ(`spent`)ì´ ì €ì¥ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤.

**[ë°ì´í„° ìƒ˜í”Œ]**

```json
{ "dept": "Marketing", "budget": 5000, "spent": 4500 },
{ "dept": "Tech", "budget": 7000, "spent": 7500 }, // ğŸ‘ˆ ì§€ì¶œì´ ì˜ˆì‚°ì„ ì´ˆê³¼í•¨
{ "dept": "HR", "budget": 3000, "spent": 2000 }
```

**[ì¿¼ë¦¬]**
ì§€ì¶œ(`spent`)ì´ ì˜ˆì‚°(`budget`)ì„ ì´ˆê³¼í•œ ëª¨ë“  ë¶€ì„œë¥¼ ì°¾ê³  ì‹¶ì„ ë•Œ `$expr`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```javascript
db.monthly_budget.find({
  $expr: { $gt: ["$spent", "$budget"] }
})
```

**[ì¿¼ë¦¬ í•´ì„¤]**

  * `$expr`: ì§‘ê³„ í‘œí˜„ì‹ì„ ì‚¬ìš©í•˜ê² ë‹¤ê³  ì„ ì–¸í•©ë‹ˆë‹¤.
  * `$gt`: "Greater Than"ì˜ ì•½ìë¡œ, ì²« ë²ˆì§¸ ì¸ìê°€ ë‘ ë²ˆì§¸ ì¸ìë³´ë‹¤ í°ì§€ ë¹„êµí•˜ëŠ” ì—°ì‚°ìì…ë‹ˆë‹¤.
  * `"$spent"`ì™€ `"$budget"`: í•„ë“œ ì´ë¦„ ì•ì— \*\*`$`\*\*ë¥¼ ë¶™ì—¬ í•´ë‹¹ í•„ë“œì˜ **ê°’**ì„ ì°¸ì¡°í•©ë‹ˆë‹¤. ì´ `$` í‘œì‹œê°€ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.

**[ê²°ê³¼]**
ìœ„ ì¿¼ë¦¬ëŠ” `spent` í•„ë“œì˜ ê°’ì´ `budget` í•„ë“œì˜ ê°’ë³´ë‹¤ í° "Tech" ë¶€ì„œ ë„íë¨¼íŠ¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

```json
{ "dept": "Tech", "budget": 7000, "spent": 7500 }
```

-----

### \#\# ì¢€ ë” ë³µì¡í•œ ì˜ˆì‹œ (ê³„ì‚° í¬í•¨)

`$expr`ì€ ë‹¨ìˆœ ë¹„êµë¿ë§Œ ì•„ë‹ˆë¼, í•„ë“œ ê°’ë“¤ì„ ì´ìš©í•œ ì—°ì‚° ê²°ê³¼ë„ ë¹„êµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**[ë°ì´í„° ìƒ˜í”Œ]**
`orders` ì»¬ë ‰ì…˜ì— ì£¼ë¬¸ ì •ë³´ê°€ ìˆê³ , ê°€ê²©(`price`)ê³¼ ìˆ˜ëŸ‰(`quantity`)ì˜ ê³±ì´ í• ì¸ ê¸°ì¤€(`discount_threshold`)ì„ ë„˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì‹¶ë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤.

```json
{ "item": "pen", "price": 5, "quantity": 20, "discount_threshold": 120 },
{ "item": "notebook", "price": 10, "quantity": 15, "discount_threshold": 140 } // ğŸ‘ˆ 10 * 15 = 150 > 140
```

**[ì¿¼ë¦¬]**
`price * quantity`ì˜ ê²°ê³¼ê°€ `discount_threshold`ë³´ë‹¤ í° ì£¼ë¬¸ì„ ì°¾ìŠµë‹ˆë‹¤.

```javascript
db.orders.find({
  $expr: {
    $gt: [
      { $multiply: ["$price", "$quantity"] }, // ë°°ì—´ì˜ ì²« ë²ˆì§¸ ì¸ì: ê³„ì‚°ëœ ì´ì•¡
      "$discount_threshold"                  // ë°°ì—´ì˜ ë‘ ë²ˆì§¸ ì¸ì: ë¹„êµí•  í•„ë“œ ê°’
    ]
  }
})
```

**[ê²°ê³¼]**
`10 * 15`ì˜ ê²°ê³¼ì¸ `150`ì´ `discount_threshold`ì¸ `140`ë³´ë‹¤ í¬ë¯€ë¡œ "notebook" ì£¼ë¬¸ì´ ë°˜í™˜ë©ë‹ˆë‹¤.

-----
