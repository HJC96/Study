## 📊 부하테스트의 기본 개념

### 1. 부하테스트란?
- **정의**: 시스템이 어느 정도의 부하(트래픽, 요청)를 견딜 수 있는지 테스트하는 것
- **목적**:
  - 서비스 배포 전 서버의 트래픽 처리 능력 파악
  - 서버가 터지기 전 미리 감지하고 대처
  - 적절한 서버 사양 선택으로 비용 최적화

### 2. 핵심 메트릭
- **Throughput (처리량)**
  - 1초당 처리할 수 있는 트래픽 양
  - 단위: TPS (Transaction Per Second) 또는 RPS (Request Per Second)
  - 예: 100 TPS = 1초에 100개의 API 요청 처리 가능

- **Latency (지연 시간)**
  - 요청에 대한 응답 시간
  - 하나의 API 요청부터 응답까지 걸리는 시간
  - 예: 평균 Latency 2.5초 = 응답받기까지 2.5초 소요

## 🔍 병목 지점 진단하기

### 1. 병목 지점(Bottleneck Point)이란?
- 전체 시스템에서 특정 서버 자원(CPU, Memory 등)이 한계에 도달해 전체 성능이 저하되는 구간
- **핵심 원리**: "병목 지점의 Throughput = 전체 시스템의 Throughput"

### 2. 병목 지점 찾는 방법

#### 모니터링 설정
1. **EC2 모니터링**
   - CloudWatch Agent 설치로 CPU, 메모리 사용률 측정
   - 1분 간격 세부 모니터링 활성화

2. **RDS 모니터링**
   - CPU 사용률 (CPUUtilization)
   - 사용 가능한 메모리 (FreeableMemory)
   - 기본적으로 1분 간격 측정

#### 진단 프로세스
1. 부하테스트 도구(k6) 실행
2. 점진적으로 트래픽 증가 (Virtual Users 증가)
3. 각 컴포넌트의 리소스 사용률 모니터링
4. CPU 또는 메모리가 100%에 도달한 컴포넌트 확인

### 3. 리소스 사용 패턴 이해
- **백엔드 서버**: 주로 CPU 집약적 (로직 처리)
- **데이터베이스**: CPU와 메모리 모두 집약적 (데이터 처리, 연산)
- **로드밸런서**: CPU 집약적 (트래픽 분배)
- **캐시(Redis)**: 메모리 집약적 (빠른 데이터 접근)

## 🚀 병목 지점 해결해 성능 개선하기

### 1. DB가 병목 지점일 경우

#### 우선순위별 해결 방법
1. **비효율적인 쿼리 개선** (최우선)
   - 인덱스 생성
   - SQL 튜닝
   - 역정규화

2. **수직적 확장**
   - DB 서버 스펙 업그레이드 (CPU, 메모리)

3. **읽기 전용 DB (Read Replica) 도입**
   - 읽기 트래픽 분산

4. **캐시 서버 도입**
   - Redis 등을 활용한 빈번한 조회 데이터 캐싱

### 2. 웹 애플리케이션 서버(EC2)가 병목 지점일 경우

#### 우선순위별 해결 방법
1. **애플리케이션 로직 개선**
   - 비효율적인 코드 최적화

2. **정적 파일 분리**
   - S3, CloudFront 활용

3. **수평적 확장** (권장)
   - 로드밸런서(ELB)를 통한 서버 대수 증가
   - 시스템 이중화로 가용성 향상
   - 확장 제한 없음

4. **수직적 확장**
   - 서버 스펙 업그레이드

### 3. 성능 개선 전략 비교

#### 수평적 확장
- **장점**: 시스템 이중화(가용성↑), 무제한 확장, 쉬운 축소/확장
- **단점**: 로드밸런서 등 추가 구성 필요

#### 수직적 확장
- **장점**: 구성 심플, 관리 비용 적음
- **단점**: 확장 한계 존재, 서비스 중단 필요(가용성↓)

### 4. 부하테스트 전체 프로세스

1. **필요성 인식** → 2. **목표 설정** (목표 TPS, Latency) → 3. **현재 시스템 테스트** → 4. **병목 지점 파악 및 개선** → 5. **개선 후 재테스트**

이 사이클을 목표치 달성까지 반복하며, 실제 사례에서는:
- 초기: 3 TPS (RDS 병목)
- 인덱스 추가 후: 4 TPS
- EC2 수평 확장 후: 7 TPS
